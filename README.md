KDV Integrator (v6.5)

KDV Integrator ‚Äî —Ü–µ middleware-—Å–µ—Ä–≤—ñ—Å –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–æ–≤–∞–Ω–æ—ó —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—ó –±—ñ–±–ª—ñ–æ—Ç–µ—á–Ω–æ—ó —Å–∏—Å—Ç–µ–º–∏ Koha ILS —Ç–∞ —Ü–∏—Ñ—Ä–æ–≤–æ–≥–æ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—é DSpace 7/8.

–°–∏—Å—Ç–µ–º–∞ –∑–∞–±–µ–∑–ø–µ—á—É—î –ø–µ—Ä–µ–¥–∞—á—É –º–µ—Ç–∞–¥–∞–Ω–∏—Ö, PDF-—Ñ–∞–π–ª—ñ–≤, –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω—É –≥–µ–Ω–µ—Ä–∞—Ü—ñ—é –æ–±–∫–ª–∞–¥–∏–Ω–æ–∫ —Ç–∞ –∑–≤–æ—Ä–æ—Ç–Ω—É —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—é –ø–æ—Å–∏–ª–∞–Ω—å.

üöÄ –ö–ª—é—á–æ–≤—ñ –º–æ–∂–ª–∏–≤–æ—Å—Ç—ñ

Async Core: API –º–∏—Ç—Ç—î–≤–æ –ø–æ–≤–µ—Ä—Ç–∞—î task_id, –≤–∏–∫–æ–Ω—É—é—á–∏ –≤–∞–∂–∫—ñ –æ–ø–µ—Ä–∞—Ü—ñ—ó —É —Ñ–æ–Ω–æ–≤–æ–º—É —Ä–µ–∂–∏–º—ñ (–∑–∞—Ö–∏—Å—Ç –≤—ñ–¥ Cloudflare Timeout).

Parallel Processing: –ì–µ–Ω–µ—Ä–∞—Ü—ñ—è –æ–±–∫–ª–∞–¥–∏–Ω–∫–∏ —Ç–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –≤ DSpace –≤—ñ–¥–±—É–≤–∞—é—Ç—å—Å—è –æ–¥–Ω–æ—á–∞—Å–Ω–æ (Fork-Join pattern), —â–æ –ø—Ä–∏—Å–∫–æ—Ä—é—î –æ–±—Ä–æ–±–∫—É –Ω–∞ 50%.

Cover Automator: –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è JPG-–º—ñ–Ω—ñ–∞—Ç—é—Ä –∑ –ø–µ—Ä—à–æ—ó —Å—Ç–æ—Ä—ñ–Ω–∫–∏ PDF.

CGI Protocol Bypass: –£–Ω—ñ–∫–∞–ª—å–Ω–∏–π –º–µ—Ö–∞–Ω—ñ–∑–º –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –æ–±–∫–ª–∞–¥–∏–Ω–æ–∫ —á–µ—Ä–µ–∑ –µ–º—É–ª—è—Ü—ñ—é –±—Ä–∞—É–∑–µ—Ä–∞ (–æ–±—Ö—ñ–¥ –æ–±–º–µ–∂–µ–Ω—å Koha REST API).

Data Warehouse: –ó–±–∞–≥–∞—á–µ–Ω–Ω—è MARC-–∑–∞–ø–∏—Å—ñ–≤ –ø—Ä—è–º–∏–º–∏ –ø–æ—Å–∏–ª–∞–Ω–Ω—è–º–∏ –Ω–∞ –æ–±–∫–ª–∞–¥–∏–Ω–∫–∏ (956$c) —Ç–∞ DSpace Handle (856$u).

üìÇ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ—î–∫—Ç—É (File Map)

–û–ø–∏—Å –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è –∫–æ–∂–Ω–æ–≥–æ —Ñ–∞–π–ª—É –¥–ª—è —Ä–æ–∑—Ä–æ–±–Ω–∏–∫—ñ–≤:

src/ ‚Äî –û—Å–Ω–æ–≤–Ω–∏–π –∫–æ–¥

–§–∞–π–ª

–û–ø–∏—Å

app.py

–¢–æ—á–∫–∞ –≤—Ö–æ–¥—É. Flask-—Å–µ—Ä–≤–µ—Ä. –ú—ñ—Å—Ç–∏—Ç—å –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ API, –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è CORS —Ç–∞ –ª–æ–≥—ñ–∫—É –ø–∞—Ä–∞–ª–µ–ª—å–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫—É (ThreadPoolExecutor) –ø—Ä–æ—Ü–µ—Å—ñ–≤ DSpace —Ç–∞ Covers.

tasks.py

Task Manager. –†–µ–∞–ª—ñ–∑—É—î In-Memory —á–µ—Ä–≥—É –∑–∞–¥–∞—á. –í—ñ–¥–ø–æ–≤—ñ–¥–∞—î –∑–∞ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è —Ñ–æ–Ω–æ–≤–∏—Ö –ø–æ—Ç–æ–∫—ñ–≤ —Ç–∞ –∑–±–µ—Ä—ñ–≥–∞–Ω–Ω—è —Å—Ç–∞—Ç—É—Å—ñ–≤ (queued, processing, success).

koha.py

Koha Client. –ù–∞–π—Å–∫–ª–∞–¥–Ω—ñ—à–∏–π –º–æ–¥—É–ª—å. –†–µ–∞–ª—ñ–∑—É—î: 



1. REST API (—á–∏—Ç–∞–Ω–Ω—è/–æ–Ω–æ–≤–ª–µ–Ω–Ω—è MARC).



2. CGI Emulation: –õ–æ–≥—ñ–Ω, –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ñ–∞–π–ª—ñ–≤ (AJAX headers spoofing), –ø–∞—Ä—Å–∏–Ω–≥ HTML (Screen Scraping) –¥–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è ID –∫–∞—Ä—Ç–∏–Ω–æ–∫.

dspace.py

DSpace Client. –†–æ–±–æ—Ç–∞ –∑ REST API DSpace 7+. –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—è (XSRF), —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è Items, –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è Bitstreams, –ø–æ—à—É–∫ –¥—É–±–ª—ñ–∫–∞—Ç—ñ–≤.

covers.py

Cover Service. –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î pdf2image (poppler) –¥–ª—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü—ñ—ó –ø–µ—Ä—à–æ—ó —Å—Ç–æ—Ä—ñ–Ω–∫–∏ PDF —É JPG. –ö–æ–Ω—Ç—Ä–æ–ª—é—î —Ä–æ–∑–º—ñ—Ä–∏ —Ç–∞ —è–∫—ñ—Å—Ç—å –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è.

config.py

Configuration. –ó–∞–≤–∞–Ω—Ç–∞–∂—É—î –∑–º—ñ–Ω–Ω—ñ –∑ .env. –ú—ñ—Å—Ç–∏—Ç—å –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –Ω–∞—è–≤–Ω–æ—Å—Ç—ñ –∫—Ä–∏—Ç–∏—á–Ω–∏—Ö –∑–º—ñ–Ω–Ω–∏—Ö.

mapping.py

Metadata Rules. –°–ª–æ–≤–Ω–∏–∫ –ø—Ä–∞–≤–∏–ª –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü—ñ—ó –ø–æ–ª—ñ–≤ MARC -> Dublin Core (Regex –¥–ª—è —Ä–æ–∫—É, –æ–±'—î–¥–Ω–∞–Ω–Ω—è –∞–≤—Ç–æ—Ä—ñ–≤ —Ç–æ—â–æ).

scripts/ ‚Äî –£—Ç–∏–ª—ñ—Ç–∏

–§–∞–π–ª

–û–ø–∏—Å

robot.py

–°–∫—Ä–∏–ø—Ç –¥–ª—è –º–∞—Å–æ–≤–æ—ó –ø–∞–∫–µ—Ç–Ω–æ—ó –æ–±—Ä–æ–±–∫–∏ –∫–Ω–∏–≥ (Batch Processing).

nightwalker.py

–ê—É–¥–∏—Ç —Å–∏—Å—Ç–µ–º–∏: –ø–æ—à—É–∫ "–∑–æ–º–±—ñ" (—Ñ–∞–π–ª–∏ –±–µ–∑ –ª—ñ–Ω–∫—ñ–≤) —Ç–∞ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—è –º–µ—Ç–∞–¥–∞–Ω–∏—Ö.

debug_*.py

–î—ñ–∞–≥–Ω–æ—Å—Ç–∏—á–Ω—ñ —Å–∫—Ä–∏–ø—Ç–∏ –¥–ª—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –æ–∫—Ä–µ–º–∏—Ö –≤—É–∑–ª—ñ–≤ (CGI –ª–æ–≥—ñ–Ω, —Å–∫—Ä–∞–ø—ñ–Ω–≥).

üõ† –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è —Ç–∞ –ó–∞–ø—É—Å–∫

1. –ó–º—ñ–Ω–Ω—ñ —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞ (.env)

–°—Ç–≤–æ—Ä—ñ—Ç—å —Ñ–∞–π–ª .env –Ω–∞ –æ—Å–Ω–æ–≤—ñ –ø—Ä–∏–∫–ª–∞–¥—É:

# KOHA CONFIG
KOHA_API_URL=[http://koha-intra.local](http://koha-intra.local)   # Staff Interface
KOHA_OPAC_URL=[https://biblio.univ.edu](https://biblio.univ.edu)  # Public Interface (–¥–ª—è –ª—ñ–Ω–∫—ñ–≤)
KOHA_API_USER=kdv_bot
KOHA_API_PASS=secret

# DSPACE CONFIG
DSPACE_API_URL=[https://repo.univ.edu/server](https://repo.univ.edu/server)
DSPACE_UI_URL=[https://repo.univ.edu](https://repo.univ.edu)
DSPACE_API_USER=admin@univ.edu
DSPACE_API_PASS=secret

# INTEGRATOR CONFIG
KDV_API_TOKEN=your-secure-token
INTEGRATOR_MOUNT_PATH=/mnt/drive
FOLDER_PROCESSED=Processed
FOLDER_ERROR=Error


2. –ó–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ Docker

docker compose up -d --build


–ö–æ–º–∞–Ω–¥–∞ –∑–∞–ø—É—Å–∫—É –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î gunicorn –∑ 1 –≤–æ—Ä–∫–µ—Ä–æ–º —Ç–∞ 4 –ø–æ—Ç–æ–∫–∞–º–∏ –¥–ª—è –ø—ñ–¥—Ç—Ä–∏–º–∫–∏ —Å–ø—ñ–ª—å–Ω–æ—ó –ø–∞–º'—è—Ç—ñ –∑–∞–¥–∞—á:
gunicorn -w 1 --threads 4 -b 0.0.0.0:5000 src.app:app

üîó API Endpoints

1. –ü–æ—á–∞—Ç–∏ —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—é (Async)

POST /kdv/api/integrate/{biblionumber}

Headers: X-KDV-TOKEN: ...

Response: 202 Accepted + {"task_id": "..."}

2. –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —Å—Ç–∞—Ç—É—Å

GET /kdv/api/status/{task_id}

Response: {"status": "processing" | "success" | "error", "result": {...}}

3. –û–Ω–æ–≤–∏—Ç–∏ –º–µ—Ç–∞–¥–∞–Ω—ñ (Sync)

PUT /kdv/api/integrate/{biblionumber}

–û–Ω–æ–≤–ª—é—î –Ω–∞–∑–≤—É/–∞–≤—Ç–æ—Ä—ñ–≤ —É DSpace –Ω–∞ –æ—Å–Ω–æ–≤—ñ –∑–º—ñ–Ω —É Koha.